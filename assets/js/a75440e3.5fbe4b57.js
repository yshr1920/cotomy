"use strict";(globalThis.webpackChunkreference_site=globalThis.webpackChunkreference_site||[]).push([[7496],{8432(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"reference/getting-started/api-integration","title":"API Client Basics","description":"CotomyApi represents Cotomy\'s API layer. It does not interact with","source":"@site/docs/reference/getting-started/05-api-integration.md","sourceDirName":"reference/getting-started","slug":"/reference/getting-started/api-integration","permalink":"/cotomy/reference/getting-started/api-integration","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"API Client Basics","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Forms Basics","permalink":"/cotomy/reference/getting-started/forms-basics"},"next":{"title":"Ajax Form","permalink":"/cotomy/reference/getting-started/ajax-form"}}');var o=t(4848),i=t(8453);const a={title:"API Client Basics",sidebar_position:5},r="API Client Basics",l={},c=[{value:"When to Use CotomyApi",id:"when-to-use-cotomyapi",level:2},{value:"Goals",id:"goals",level:2},{value:"Related Classes",id:"related-classes",level:2},{value:"Steps",id:"steps",level:2},{value:"1) Create an API client",id:"1-create-an-api-client",level:3},{value:"2) Send a GET request",id:"2-send-a-get-request",level:3},{value:"3) Send POST or PUT",id:"3-send-post-or-put",level:3},{value:"About FormData",id:"about-formdata",level:2},{value:"4) Handle errors",id:"4-handle-errors",level:3},{value:"5) Use API with UI events",id:"5-use-api-with-ui-events",level:3},{value:"Important Concept: API and UI Are Separate Layers",id:"important-concept-api-and-ui-are-separate-layers",level:2},{value:"CotomyApi does not:",id:"cotomyapi-does-not",level:3},{value:"Note: Rendering API Responses",id:"note-rendering-api-responses",level:2},{value:"What just happened?",id:"what-just-happened",level:2},{value:"Next",id:"next",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"api-client-basics",children:"API Client Basics"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"CotomyApi"})," represents Cotomy's API layer. It does not interact with\nthe UI unless you explicitly connect it."]}),"\n",(0,o.jsx)(n.p,{children:"This separation keeps UI updates explicit and avoids hidden client state."}),"\n",(0,o.jsx)(n.p,{children:"Cotomy provides an API client that can be used independently of forms.\nUse this when you need to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Load data when a page starts"}),"\n",(0,o.jsx)(n.li,{children:"Trigger actions from buttons or UI elements"}),"\n",(0,o.jsx)(n.li,{children:"Fetch reference data for UI components"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"when-to-use-cotomyapi",children:"When to Use CotomyApi"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"CotomyApi"})," whenever the page needs to communicate with the server outside\nof a form submission. Typical cases:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Loading initial page data"}),"\n",(0,o.jsx)(n.li,{children:"Fetching reference lists (select options, lookup data)"}),"\n",(0,o.jsx)(n.li,{children:"Executing button-triggered actions"}),"\n",(0,o.jsx)(n.li,{children:"Background saves or state updates"}),"\n",(0,o.jsx)(n.li,{children:"Periodic or manual refresh operations"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Send API requests without a form"}),"\n",(0,o.jsx)(n.li,{children:"Handle responses and errors"}),"\n",(0,o.jsxs)(n.li,{children:["Understand ",(0,o.jsx)(n.code,{children:"CotomyApi"}),"'s role"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"related-classes",children:"Related Classes"}),"\n",(0,o.jsx)(n.mermaid,{value:"classDiagram\nclass CotomyApi\nclass CotomyElement\n\nCotomyElement ..> CotomyApi : connects"}),"\n",(0,o.jsx)(n.h2,{id:"steps",children:"Steps"}),"\n",(0,o.jsx)(n.h3,{id:"1-create-an-api-client",children:"1) Create an API client"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'import { CotomyApi, CotomyElement } from "cotomy";\n\nconst api = new CotomyApi();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"2-send-a-get-request",children:"2) Send a GET request"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'const response = await api.getAsync("/api/profile");\n\nif (response.ok && response.available) {\n\tconst data = await response.objectAsync();\n\tconsole.log(data);\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"3-send-post-or-put",children:"3) Send POST or PUT"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'const formData = new FormData();\nformData.set("name", "Alice");\n\nconst response = await api.submitAsync({\n\tmethod: "post",\n\taction: "/api/profile",\n\tbody: formData,\n});\n'})}),"\n",(0,o.jsx)(n.h2,{id:"about-formdata",children:"About FormData"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"CotomyApi"})," accepts a standard ",(0,o.jsx)(n.code,{children:"FormData"})," object as the request body. You can\ninclude text fields, numbers (as strings), files (",(0,o.jsx)(n.code,{children:"File"})," or ",(0,o.jsx)(n.code,{children:"Blob"}),"), and\nmultiple values for the same key."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'const fileInput = CotomyElement.first(`input[type="file"]`)!;\n\nconst data = new FormData();\ndata.set("name", "Alice");\ndata.set("age", "30");\ndata.append("photo", fileInput.element.files?.[0]!);\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsxs)(n.strong,{children:["Cotomy does not modify ",(0,o.jsx)(n.code,{children:"FormData"}),". It sends it as-is."]})}),"\n",(0,o.jsxs)(n.p,{children:["You can also pass a plain object (",(0,o.jsx)(n.code,{children:"Record<string, string | number>"}),") and\nCotomy will convert it to ",(0,o.jsx)(n.code,{children:"FormData"})," when using ",(0,o.jsx)(n.code,{children:"multipart/form-data"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'const data = {\n\tname: "Alice",\n\tage: 30,\n};\n\nawait api.submitAsync({\n\tmethod: "post",\n\taction: "/api/profile",\n\tbody: data,\n});\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Object values are converted to strings when building ",(0,o.jsx)(n.code,{children:"FormData"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"4-handle-errors",children:"4) Handle errors"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"CotomyApi"})," throws exceptions for HTTP errors. Handle them with ",(0,o.jsx)(n.code,{children:"try/catch"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'try {\n\tawait api.getAsync("/api/profile");\n} catch (e) {\n\tconsole.error("API error", e);\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"5-use-api-with-ui-events",children:"5) Use API with UI events"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'const statsElement = CotomyElement.first(".stats")!;\nconst button = CotomyElement.first(".refresh-btn")!;\n\nbutton.on("click", async () => {\n\tconst response = await api.getAsync("/api/stats");\n\tconst stats = await response.objectAsync();\n\tstatsElement.text = stats.count.toString();\n});\n'})}),"\n",(0,o.jsx)(n.p,{children:"You manually update the DOM with the result. Cotomy does not auto-bind API data\nto the UI."}),"\n",(0,o.jsx)(n.h2,{id:"important-concept-api-and-ui-are-separate-layers",children:"Important Concept: API and UI Are Separate Layers"}),"\n",(0,o.jsx)(n.p,{children:"Cotomy keeps API communication separate from UI state."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CotomyApi"})," handles HTTP"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"CotomyElement"})," manages UI"]}),"\n",(0,o.jsx)(n.li,{children:"You connect them explicitly"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"cotomyapi-does-not",children:"CotomyApi does not:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Automatically update UI"}),"\n",(0,o.jsx)(n.li,{children:"Manage application state"}),"\n",(0,o.jsx)(n.li,{children:"Cache responses globally"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"CotomyApi does not retain request or response state. Each call is independent.\nThis keeps long-lived systems predictable and easier to maintain."}),"\n",(0,o.jsx)(n.p,{children:"Each API call is stateless from the client perspective."}),"\n",(0,o.jsx)(n.p,{children:"CotomyApi does not introduce a client-side data store."}),"\n",(0,o.jsx)(n.h2,{id:"note-rendering-api-responses",children:"Note: Rendering API Responses"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"CotomyApi"})," only handles HTTP communication. If you want to apply server\nresponses to the UI automatically, use a form-based approach with\n",(0,o.jsx)(n.code,{children:"CotomyViewRenderer"}),". This is covered in the Ajax Form section."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"CotomyViewRenderer"})," applies response JSON to elements marked with\n",(0,o.jsx)(n.code,{children:"data-cotomy-bind"}),", and you can choose a bind name style with\n",(0,o.jsx)(n.code,{children:"CotomyBracketBindNameGenerator"})," or ",(0,o.jsx)(n.code,{children:"CotomyDotBindNameGenerator"}),".\nSee ",(0,o.jsx)(n.a,{href:"/cotomy/reference/classes/api/cotomy-view-renderer",children:"CotomyViewRenderer\u306e\u8a73\u7d30"}),",\n",(0,o.jsx)(n.a,{href:"/cotomy/reference/classes/api/cotomy-bracket-bind-name-generator",children:"CotomyBracketBindNameGenerator\u306e\u8a73\u7d30"}),", and\n",(0,o.jsx)(n.a,{href:"/cotomy/reference/classes/api/cotomy-dot-bind-name-generator",children:"CotomyDotBindNameGenerator\u306e\u8a73\u7d30"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"what-just-happened",children:"What just happened?"}),"\n",(0,o.jsx)(n.p,{children:"You:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Created an API client"}),"\n",(0,o.jsx)(n.li,{children:"Sent requests"}),"\n",(0,o.jsx)(n.li,{children:"Processed responses"}),"\n",(0,o.jsx)(n.li,{children:"Connected results to the UI"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"next",children:"Next"}),"\n",(0,o.jsxs)(n.p,{children:["Next: ",(0,o.jsx)(n.a,{href:"/cotomy/reference/getting-started/ajax-form",children:"Ajax Form"})," to combine forms and API requests."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);